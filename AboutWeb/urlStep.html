<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一个页面从输入 URL 到页面加载显示完成，这个过程中发生了什么？ | About WEB</title>
    <meta name="description" content=" ">
    
    
    <link rel="preload" href="/docs/assets/css/styles.ab047dc6.css" as="style"><link rel="preload" href="/docs/assets/js/app.ab047dc6.js" as="script"><link rel="preload" href="/docs/assets/js/6.ad3d549e.js" as="script"><link rel="prefetch" href="/docs/assets/css/1.styles.2d4889db.css"><link rel="prefetch" href="/docs/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/docs/assets/js/1.2d4889db.js"><link rel="prefetch" href="/docs/assets/js/10.beedb173.js"><link rel="prefetch" href="/docs/assets/js/11.38fcae96.js"><link rel="prefetch" href="/docs/assets/js/12.5a305181.js"><link rel="prefetch" href="/docs/assets/js/13.adff57d9.js"><link rel="prefetch" href="/docs/assets/js/14.924350aa.js"><link rel="prefetch" href="/docs/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/docs/assets/js/3.769125cb.js"><link rel="prefetch" href="/docs/assets/js/4.795d25b2.js"><link rel="prefetch" href="/docs/assets/js/5.21cfd9d9.js"><link rel="prefetch" href="/docs/assets/js/7.380b2ef2.js"><link rel="prefetch" href="/docs/assets/js/8.2c5caa80.js"><link rel="prefetch" href="/docs/assets/js/9.e8f57114.js">
    <link rel="stylesheet" href="/docs/assets/css/1.styles.2d4889db.css"><link rel="stylesheet" href="/docs/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/docs/assets/css/styles.ab047dc6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">About WEB</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/AboutWeb/" class="nav-link router-link-active">前端整理</a></div><div class="nav-item"><a href="/docs/ECMAScript6/" class="nav-link">ECMAScript6</a></div><div class="nav-item"><a href="/docs/miniprogram/" class="nav-link">微信小程序</a></div><div class="nav-item"><a href="/docs/前端整理/" class="nav-link">面试</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/AboutWeb/" class="nav-link router-link-active">前端整理</a></div><div class="nav-item"><a href="/docs/ECMAScript6/" class="nav-link">ECMAScript6</a></div><div class="nav-item"><a href="/docs/miniprogram/" class="nav-link">微信小程序</a></div><div class="nav-item"><a href="/docs/前端整理/" class="nav-link">面试</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>AboutWeb</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/AboutWeb/" class="sidebar-link">前端知识整理</a></li><li><a href="/docs/AboutWeb/web.html" class="sidebar-link">前端整理</a></li><li><a href="/docs/AboutWeb/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/docs/AboutWeb/urlStep.html" class="active sidebar-link">一个页面从输入 URL 到页面加载显示完成，这个过程中发生了什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#dns-domain-name-system，域名系统-解析" class="sidebar-link">DNS(Domain Name System，域名系统)解析</a></li><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#tcp-链接-三次握手" class="sidebar-link">TCP 链接(三次握手)</a></li><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#发送-http-请求" class="sidebar-link">发送 HTTP 请求</a></li><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#服务器处理请求并返回-http-报文" class="sidebar-link">服务器处理请求并返回 HTTP 报文</a></li><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#浏览器解析渲染页面" class="sidebar-link">浏览器解析渲染页面</a></li><li class="sidebar-sub-header"><a href="/docs/AboutWeb/urlStep.html#连接结束" class="sidebar-link">连接结束</a></li></ul></li><li><a href="/docs/AboutWeb/plug.html" class="sidebar-link">Vue 相关知识点</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="一个页面从输入-url-到页面加载显示完成，这个过程中发生了什么？"><a href="#一个页面从输入-url-到页面加载显示完成，这个过程中发生了什么？" aria-hidden="true" class="header-anchor">#</a> 一个页面从输入 URL 到页面加载显示完成，这个过程中发生了什么？</h1> <ul><li>DNS 解析</li> <li>TCP 链接</li> <li>发送 HTTP 请求</li> <li>服务器处理请求返回 HTTP 报文</li> <li>浏览器解析渲染页面</li> <li>链接结束</li></ul> <h2 id="dns-domain-name-system，域名系统-解析"><a href="#dns-domain-name-system，域名系统-解析" aria-hidden="true" class="header-anchor">#</a> DNS(Domain Name System，域名系统)解析</h2> <p>DNS 解析的过程就是寻找哪台机器上有你需要资源的过程。<strong>网址到 IP 的转换</strong></p> <h2 id="tcp-链接-三次握手"><a href="#tcp-链接-三次握手" aria-hidden="true" class="header-anchor">#</a> TCP 链接(三次握手)</h2> <p>通信连接的建立需要经历以下三个过程： <br></p> <ul><li>主机向服务器发送一个建立链接的请求</li> <li>服务器接到请求后发送同意链接的信号</li> <li>主机接到同意请求的信号后，再次向服务器发送确认信号，自此，主机与服务器两者建立链接
(<em>三次握手的过程采用 TCP 协议，其可以保证信息传输的可靠性，三次握手过程中，若一方收不到确认信号，协议会要求重新发送信号</em>)</li></ul> <h2 id="发送-http-请求"><a href="#发送-http-请求" aria-hidden="true" class="header-anchor">#</a> 发送 HTTP 请求</h2> <p>当服务器与主机建立了连接之后，下面主机便与服务器进行通信。网页请求是一个单向请求的过程，即是一个主机向服务器请求数据，服务器返回相应的数据的过程。
浏览器根据 URL 内容生成 HTTP 请求，HTTP 请求报文是由三部分组成: 请求行, 请求报头和请求正文</p> <h2 id="服务器处理请求并返回-http-报文"><a href="#服务器处理请求并返回-http-报文" aria-hidden="true" class="header-anchor">#</a> 服务器处理请求并返回 HTTP 报文</h2> <p>服务器接到请求后，会根据 HTTP 请求中的内容来决定如何获取相应的 HTML 文件；
服务器将得到的 HTML 文件发送给浏览器；
HTTP 响应报文也是由三部分组成: 状态码, 响应报头和响应报文</p> <ul><li>1 状态吗
<ul><li>1XX: 指示信息-表示请求已连接，继续处理</li> <li>2XX：成功-表示请求已被成功接受</li> <li>3XX：重定向-要完成请求必须进行更进一步的操作</li> <li>4XX：客户端错误-请求有语法错误或请求无法实现</li> <li>5XX：服务器端错误-服务器未能实现合法的请求</li></ul></li> <li>2 响应报头
<ul><li>常见的响应包头字段有：Server，Connection...</li></ul></li> <li>3 响应报文
<ul><li>服务器返回给浏览器的文本信息，通常 HTML、CSS、JS，图片等文件放在这部分</li></ul></li></ul> <h2 id="浏览器解析渲染页面"><a href="#浏览器解析渲染页面" aria-hidden="true" class="header-anchor">#</a> 浏览器解析渲染页面</h2> <p>在浏览器还没有完全接收 HTML 文件时便开始渲染、显示网页；在执行 HTML 中代码时，根据需要，浏览器会继续请求图片、CSS、JavsScript 等文件，过程同请求 HTML
<br>
浏览器是一个便解析便渲染的过程。首先浏览器解析 HTML 文件构建 DOM 树，然后解析 CSS 文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染是并将其绘制到屏幕上。这个过程比较复杂，涉及到两个概念：<strong>reflow（回流）<strong>和</strong>repain（重绘）</strong>。页面在首次加载时必然会经历 reflow 和 repain。reflow 和 repain 过程是非常消耗性能的，尤其是在移动设备上，它会破坏用户体验，有时会造成页面卡顿。所以我们应该尽可能少的减少 reflow 和 repain。
<br> <br>
JS 的解析是由浏览器中的 JS 解析引擎完成的。JS 是单线程运行，也就是说，在同一个时间内只能做一件事，所有的任务都需要排队，前一个任务结束，后一个任务才能开始。但是又存在某些任务比较时，如 IO 读写等，所以需要一种机制可以先执行排在后面的任务，这就是：同步任务(synchronous)和异步任务(asynchronous)。JS 的执行机制就可以看做是一个主线程加上一个任务队列(task queue)同步任务就是放在主线程上执行的任务，异步任务是放在任务队列中的任务。所有的同步任务在主线程上执行，形成一个执行栈;异步任务有了运行结果就会在任务队列中放置一个事件；脚本运行时先依次运执行栈，然后会从任务队列里提取事件，运行任务队列中的任务，这个过程是不断重复的，所以又叫做事件循环(Event loop)。
<br> <br>
浏览器在解析过程中，如果遇到请求外部资源时，如图像,iconfont,JS 等。浏览器将重复 1-6 过程下载该资源。请求过程是异步的，并不会影响 HTML 文档进行加载，但是当文档加载过程中遇到 JS 件，HTML 文档会挂起渲染过程，不仅要等到文档中 JS 文件加载完毕还要等待解析执行完毕，才会继续 HTML 的渲染过程。原因是因为 JS 有可能修改 DOM 结构，这就意味着 JS 执行完成前，后续所有源的下载是没有必要的，这就是 JS 阻塞后续资源下载的根本原因。CSS 文件的加载不影响 JS 文件的加载，但是却影响 JS 文件的执行。JS 代码执行前浏览器必须保证 CSS 文件已经下载并加载完毕</p> <h2 id="连接结束"><a href="#连接结束" aria-hidden="true" class="header-anchor">#</a> 连接结束</h2> <ul><li>主机向服务器发送一个断开链接的请求</li> <li>服务器接到请求后发送确认收到请求的信号</li> <li>服务器向主机发送断开通知</li> <li>主机连接断开通知后断开连接并反馈一个确认信号，服务器收到确认信号后断开连接</li></ul> <blockquote><p><strong>reflow（回流）<strong>和</strong>repain（重绘）</strong></p></blockquote> <ul><li><strong>reflow（回流）</strong>：当 Render Tree 中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流
<ul><li>会导致回流的操作
<ul><li>页面首次渲染</li> <li>浏览器窗口大小的改变</li> <li>元素尺寸或位置发生变化</li> <li>元素内容变化（文字数量或图片大小等等）</li> <li>元素字体大小的变化</li> <li>添加或者删除可见的<code>DOM</code>元素</li> <li>激活<code>CSS</code>伪类（例如：<code>:hover</code>）</li> <li>查询某些属性或调用某些方法</li></ul></li> <li>一些常用且会导致回流的属性和方法
<ul><li>clientWidth、clientHeight、clientTop、clientLeft</li> <li>offsetWidth、offsetHeight、offsetTop、offsetLeft</li> <li>scrollWidth、scrollHeight、scrollTop、scrollLeft</li> <li>scrollIntoView()、scrollIntoViewIfNeeded()</li> <li>getComputedStyle()</li> <li>getBoundingClientRect()</li> <li>scrollTo()</li></ul></li></ul></li> <li><strong>repain（重绘）</strong>: 页面中元素样式的改变并不影响它在文档流中的位置时（例如：color、background-color、visibility 等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</li> <li><strong>性能影响</strong>: 回流比重绘的代价更高(<em>有时即使仅仅回流一个单一的元素，它的父元素以及任何跟随它的元素也会产生回流。</em>) <br> <strong>现代浏览器会对频繁的回流或重绘操作进行优化：浏览器会维护一个队列，把所有引起回流和重绘的操作放入队列中，如果队列中的任务数量或者时间间隔达到一个阈值的，浏览器就会将队列清空，进行一次批处理，这样可以把多次回流和重绘变成一次。</strong></li> <li><strong>如何避免</strong> <ul><li>CSS
<ul><li>避免使用 table 布局</li> <li>尽量可能在 DOM 树的最末端改变 class</li> <li>避免设置多层内联样式</li> <li>将动画效果应用到<code>position</code>属性为<code>absolute</code>或<code>fixed</code>的元素上</li> <li>避免使用<code>CSS</code>表达式（例如：<code>calc()</code>）</li></ul></li> <li>JavaScript
<ul><li>避免频繁的操作样式，最好一次性重写 style 属性，或者将样式列表定义为 class 并一次性更改 class 属性</li> <li>避免频繁的操作 DOM，创建一个<code>documentFragment</code>，在它上面应用所有的 DOM 操作，最后再把它添加到文档中</li> <li>先为元素设置<code>display：none</code>，操作结束后再把它显示出来。因为<code>dispaly</code>属性为<code>none</code>的元素上进行 DOM 操作不会引发回流和重绘</li> <li>避免频繁读取会引发回流/重绘的属性，如果确实需要多此使用，就用一个变量缓存起来</li> <li>对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流</li></ul></li></ul></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">12/27/2018, 11:19:21 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/AboutWeb/CDN.html" class="prev">
          CDN
        </a></span> <span class="next"><a href="/docs/AboutWeb/plug.html">
          Vue 相关知识点
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/6.ad3d549e.js" defer></script><script src="/docs/assets/js/app.ab047dc6.js" defer></script>
  </body>
</html>
